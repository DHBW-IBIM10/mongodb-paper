\title{\papertitle}

\author{Rocco Schulz and Robert Wawrzyniak}
	
\publishers{Corporate State University\\Baden-Wuerttemberg - Stuttgart}

\date{
\vspace{0.6cm}
provided on 6 May 2013\\
\vspace{0.6cm}
School of: Business\\
\vspace{0.6cm}
Program: International Business Information Management\\
\vspace{0.6cm}
Course: WWI2010I\\
\vspace{0.6cm}
}





% DOCUMENT
\renewcommand{\baselinestretch}{1.5}\normalsize
\begin{document}
\pagestyle{scrheadings}

% roman numerals
\renewcommand{\thepage}{\Roman{page}}
% page numbers centered on top:
\chead{\pagemark}
\cfoot{}

%----------------------------------------------------------------------------
% Title Page
%----------------------------------------------------------------------------

% no page numbering
\thispagestyle{empty}
% include title page
\input{title_page}


%  \begin{abstract}
%  \vspace{1.6cm}
% % \textbf{\abstractname}: 
%  \end{abstract}


%----------------------------------------------------------------------------
% Table of Contents
%----------------------------------------------------------------------------
\tableofcontents
\newpage


%----------------------------------------------------------------------------
% Abbreviations
%----------------------------------------------------------------------------
% List needs to be indexed after each change.
% This is done by executing the following command:
% ~$ makeindex [filename].nlo -s nomencl.ist -o [filename].nls
\printnomenclature
\addcontentsline{toc}{section}{List of Abbreviations}
\input{nomenclature.tex}

\newpage

%----------------------------------------------------------------------------
% List Of Tables
%----------------------------------------------------------------------------
\listoftables
\addcontentsline{toc}{section}{\listtablename}
\newpage


%----------------------------------------------------------------------------
% List of Figures
%----------------------------------------------------------------------------
\listoffigures
\addcontentsline{toc}{section}{\listfigurename}
\newpage

%----------------------------------------------------------------------------
% List of Listings
%----------------------------------------------------------------------------
%\lstlistoflistings
\listoflistings
\addcontentsline{toc}{section}{List of Listings}
\newpage

% Arabic numerals for page numbering
\renewcommand{\thepage}{\arabic{page}}

% Set page number to 1: 
\setcounter{page}{1} 


%----------------------------------------------------------------------------
% Intro
%----------------------------------------------------------------------------
\section{Introduction}
\label{sec:introduction}

Introduction to NoSQL.

% These\footcite[Cf.][22]{Warden_2011} are\footcite[Cf.][23]{Tiwari_2011} just some
% dummy\footcite[Cf.][34]{Redmond_2012} references\footcite[][]{Chodorow_2011_tips}
% to test\footcite[Cf.][44]{Chodorow_2011_scaling} the bibliography\footcite[Cf.][44]{Ohiggins_2011}
% environement.\footcite[Cf.][]{mongo_manual}


\subsection{Objectives}
\label{sec:objectives}
%SMART - specific, measurable, achievable, relevant, timed

\begin{enumerate}
  \item Test installation of mongoDB
  \item Introduce basic usage (CRUD + simple analytics)
  \item Performance tests with large datasets
  \item Show programmatical usage of mongoDB in a Python web project
\end{enumerate}

\subsection{Methodology and Structure}
\label{sec:methodology}

TBD


%----------------------------------------------------------------------------
% Theoretical Foundation
%----------------------------------------------------------------------------
\newpage

\section{Foundation}
\label{sec:foundation}



\subsection{NoSQL Databases}
\label{sec:nosql}

\begin{enumerate}
  \item nosql describes a range of data store technologies that do not have an sql interface
  \item there are multiple types of nosql data stores, these are briefly introduced in the following sections
\end{enumerate}
Main differences between RDBS and noSQL should be listed to avoid that readers
look at things as if they were conventional databases. they are not.

\paragraph{Key-Value Stores}
\label{sec:nosql-key-value}
As the name implies a key-value store maps keys to values in a similar way as a
map or hashtable would in a high level programming
language.\footcite[Cf.][4]{Redmond_2012} Such data structures are very efficient
with an average algorithm running time of big O(1) for accessing data and
are hence often used for caching of data.\footcite[Cf.][p. 14 et sq.]{Tiwari_2011}
However they are not very useful when it is necessary to do queries that are
more complex than simply looking up a value for a given key.\\
There are various open source projects available, whereas memcached, Voldemort,
Redis and Riak belong to the more popular ones.\footcite[Cf.][4]{Redmond_2012}

 
\paragraph{Document Oriented Databases}
\label{sec:nosql-document}
Document oriented databases store documents which can contain a variety of
values which may be of any type, including sub-documents, so that nested 
structures can be created.\footcite[Cf.][p. 5 et sq.]{Redmond_2012}\\
These databases should not be confused with document management systems. Even
though binary documents can be stored as well, the word document in this context
refers to a structured set of keys and values that belong to a
document.\footcite[Cf.][p. 18 et sq.]{Tiwari_2011}.\\
Multiple documents form collections which can be queried. Document oriented
databases do not have a fixed schema and hence exhibit high flexibility.

Document oriented databases are not a new phenomenom as they have been around
for a few decades already. However recently a number of new open source document 
oriented databases like MongoDB and CouchDB have quickly become popular.\footcite[Cf.][p. 18 et sq.]{Tiwari_2011}


\paragraph{Graph Databases}
\label{sec:nosql-graph}
Graph databases are an excellent choice when dealing with highly interconnected
data. They consist of multiple nodes and relationships between these nodes.
Nodes as well as their relationships can contain additional information in the
form of key-value pairs.\footcite[Cf.][6]{Redmond_2012}\\
Graph databases facilitate rapid traversal through graphs by following
relationships. Well known representatives of this group of noSQL databases are
Neo4j\footnote{See \url{http://www.neo4j.org/}} and FlockDB\footnote{See
\url{https://github.com/twitter/flockdb}}.\footcite[Cf.][19]{Tiwari_2011}


\subsection{MongoDB}
\label{sec:mongodb}


``MongoDB is designed to be huge (the name mongo is extracted from the word
humongous). Mongo server configurations attempt to remain consistentâ€”if
you write something, subsequent reads will receive the same value (until the
next update). This feature makes it attractive to those coming from an RDBMS
background. It also offers atomic read-write operations such as incrementing
a value and deep querying of nested document structures. Using JavaScript
for its query language, MongoDB supports both simple queries and complex
mapreduce jobs.''\footcite[][6]{Redmond_2012}

\begin{enumerate}
  \item noSQL store that belongs to the group of document stores
  \item Documents are stored as JSON or binary JSON
  \item development history and some general information
  \item use cases
\end{enumerate}


MongoDB belongs to the group of document oriented noSQL databases and is written
in C++. It does not try to be a general purpose database but has been developed
with the philosophy ``One size does not fit all'' in mind.\footcite[Cf.][3]{Plugge_2010}

MongoDB works with documents instead of tables as opposed to conventional RDBMS.
A document is a single storage unit and multiple documents can be contained in a
collection. Documents are stored in BSON format which is a JSON based
specification.\footcite[Cf.][]{bson_spec}

A design goal of MongoDB is high availability through
replication.\footcite[Cf.][3]{Plugge_2010}
MongoDB aims for good horizontal scalability, speed and simplicity. Transaction
support has been ommitted as a tradeoff in favor of these
attributes.\footcite[Cf.][5]{Plugge_2010}

\begin{savenotes} %alloows proper citation marks inside tables
\begin{table}[ht]
\begin{tabular*}{0.95\textwidth}{p{0.45\textwidth} p{0.45\textwidth}}
\toprule
\textbf{SQL Terms/Concepts} & \textbf{MongoDB Terms/Concept}\\
\midrule 
database & 	database\\
table 	 &	collection\\
row 	 &	document or BSON document\\
column 	 &	field\\
index 	 &	index\\
table joins &	embedded documents and linking\\
primary key\newline Specify any unique column or column combination as primary
key.
		&
primary key \newline
In MongoDB, the primary key is automatically set to the \_id field.\\

\bottomrule 
\end{tabular*}
  \caption{SQL termn mapped to MongoDB source:
  \url{http://docs.mongodb.org/manual/reference/sql-comparison/}}
  \label{tab:sql-mongo-map}
\end{table}
\end{savenotes}


    
\FloatBarrier
%----------------------------------------------------------------------------
% Hands on Mongo
%----------------------------------------------------------------------------
\clearpage
\section{Setting up MongoDB}
\label{sec:setup}

\subsection{Installation}
\label{sec:installation}

\subsubsection{Windows}
\label{sec:installation-windows}
Download and follow install instructions.

\subsubsection{Linux}
\label{sec:installation-linux}
Use your favorite package manager.
Most distributions do not ship the latest version of MongoDB. This paper describes the usage of
MongoDB version 2.4 which can be obtained from 10gens own repository if not available in the
Linux distribution. See \url{http://docs.mongodb.org/manual/installation/}

\subsection{Configuration}
\label{sec:configuration}

\begin{enumerate}
  \item basic configuration of the service (ports, memory usage, etc)
  \item advanced: sharding, performance optimization, indexing
  \item advanced: distribution among several network nodes
\end{enumerate}
    
    
\newpage
\section{Using MongoDB}
\label{sec:usage}

\subsection{Test Environment Setup}
\label{sec:test-environment}

The following usage scenarios will be based on a publicly available dataset.
This section describes how to obtain and load this dataset into the previously
installed MongoDB.

The Enron Email Corpus has been ported to MongoDB and can be obtained from
\url{http://mongodb-enron-email.s3-website-us-east-1.amazonaws.com/}.
The uncompressed dataset contains approximately 500,000 emails.
While this is a relatively small dataset it is sufficient for
testing basic features of the database.

Once the archive has been downloaded and unpacked it can be loaded into MongoDB
by using the command line tool
\texttt{mongorestore}.\footcite[Cf.][TODO]{http://docs.mongodb.org/manual/reference/program/mongorestore/}
 On Linux, run the commands as shown in Lst. \ref{lst:load-enron}.

\begin{listing}
    \begin{bashcode}
    wget https://s3.amazonaws.com/mongodb-enron-email/enron_mongo.tar.bz2
    tar -xjvf enron_mongo.tar.bz2
    mongorestore --db enron --noobjcheck dump/enron_mail/
    \end{bashcode}
    \caption{Shell commands to download and load the enron email corpus into MongoDB on Linux}
    \label{lst:load-enron}
\end{listing}

Note that the loading process requires a running instance of the mongo server.
Verify that the import was successful by opening the mongo shell and typing
\texttt{show dbs}.
The output should contain a row with \texttt{enron 3.9521484375GB}\footnote{The
size of the database may differ due to different file systems}, which is the
database that has been created during the loading process.


\subsection{Command Line Interface}
\label{sec:usage-cli}

The command line interface for MongoDB is called the mongo shell and is the most powerfull
tool for operating on MongoDB databases.
The following examples assume that the Enron email corpus has been loaded into the database \textit{enron}.
In order to start working on this database, type \texttt{use enron}.

\subsubsection{Read}
Before performing any read operations it is necessary to figure out what collections
there are in the enron database, that can be read from. This information can be accessed
via the command \texttt{show collections} as shown in Lst. \ref{lst:show-collections}

\begin{listing}
    \begin{javascriptcode}
> show collections
messages
system.indexes
    \end{javascriptcode}
    \caption{Command to get a list of available collections in the current database}
    \label{lst:show-collections}
\end{listing}

\paragraph{Making Queries}
In the mongo shell, the \texttt{find()} and \texttt{findOne()} can be used to
query for data.\footcite[Cf.][7]{mongo_crud_manual}
These queries are performed by calling them on any collection.
Obtaining all emails from the messages collection is e.g. done by running
\texttt{db.messages.find()}.

The syntax of the find command is as follows: \texttt{db.collection.find(
<query>, <projection> )}\\
The <query> argument is used for filtering and the <projection> is used to specify
or limit the fields that should be returned.
The projection is hence comparable to the SELECT part of an SQL query and the
query parameter is combarable to the WHERE clause of an SQL query.


The \texttt{findOne()} method is very similar, however it only returns the first
element that matches the query. Lst. \ref{lst:findone} shows the result of the
findOne query on the messages collection without a query document provided. The
second argument tells MongoDB to exclude the body field from the result. Setting
the projection object to \texttt{\{"subject":1\}} would tell MongoDB to exclude
all fields from the result except for body.

\begin{listing}
    \begin{javascriptcode}
> db.messages.findOne({}, {"body": 0})
{
    "_id" : ObjectId("4f16fc97d1e2d32371003e27"),
    "subFolder" : "notes_inbox",
    "mailbox" : "bass-e",
    "filename" : "450.",
    "headers" : {
        "X-cc" : "",
        "From" : "michael.simmons@enron.com",
        "Subject" : "Re: Plays and other information",
        "X-Folder" : "\\Eric_Bass_Dec2000\\Notes Folders\\Notes inbox",
        "Content-Transfer-Encoding" : "7bit",
        "X-bcc" : "",
        "To" : "eric.bass@enron.com",
        "X-Origin" : "Bass-E",
        "X-FileName" : "ebass.nsf",
        "X-From" : "Michael Simmons",
        "Date" : "Tue, 14 Nov 2000 08:22:00 -0800 (PST)",
        "X-To" : "Eric Bass",
        "Message-ID" : "<6884142.1075854677416.JavaMail.evans@thyme>",
        "Content-Type" : "text/plain; charset=us-ascii",
        "Mime-Version" : "1.0"
    }
}
    \end{javascriptcode}
    \caption{findOne query on the messages collection}
    \label{lst:findone}
\end{listing}

As can be seen from the output in Lst. \ref{lst:findone} there can also be nested documents
within one document. In this case the headers field contains an object with all header fields.
MongoDB allows querying for nested attributes as well. So in order to find out the percentage of
replies among all emails we could run the following commands:

\begin{listing}
    \begin{javascriptcode}
> nAll = db.messages.count()
501513
> nReply = db.messages.find({"headers.Subject": /Re:.*/}).count()
100195
> nReply / nAll * 100
19.978544923062813
    \end{javascriptcode}
    \caption{caption}
    \label{lst:label}
\end{listing}

\paragraph{Optimizing Queries}
Can be optimized with indexes and some other tips given in
iterature.\footcite[Cf.][TODO]{Chodorow_2011_tips}


\subsubsection{Create}
Documents can be created with the \texttt{insert()} command in the mongo
shell.\\
Bulk inserts are also possible.\footcite[Cf.][p. 53 et sqq.]{mongo_crud_manual}

\subsubsection{Update}
Updates can be done with the \texttt{update()} command and the \texttt{save()}
command.\footcite[Cf.][p. 75 et. sqq.]{mongo_crud_manual}

\subsubsection{Delete}
Delete operations for one or multiple documents can be performed with
\texttt{db.collection.remove()}.\footcite[Cf.][p. 83 et.
sqq.]{mongo_crud_manual}


\subsection{Programmatically}
\label{sec:usage-programmatically}
\begin{enumerate}
  \item Using MongoDB as a module of a application is probably the most common usage scenario
  \item Interfaces for a large number of programming languages exist
  \item Some basic operations can be shown in Ruby, Java, Python, JavaScript
\end{enumerate}


\subsection{Graphical Interfaces}
\label{sec:usage-gui}
there are UI based admin tools by 3rd party developers\\
show a small selection of them

\newpage
\section{Maintaining MongoDB}
\label{sec:maintenance}

\subsection{Monitoring}
\label{sec:maintenance-monitroing}
Can be done manually via the CLI
Monitoring tools for automation are included in the default installation

\subsection{Updating}
\label{sec:maintenance-updating}
TODO



%----------------------------------------------------------------------------
% Closing
%----------------------------------------------------------------------------

\newpage
\section{Conclusion and Outlook}
\label{sec:conclusion}

MongoDB should not be seen as an alternative for conventional RDBS but as a
complementary module in application development.\\
TODO.


%----------------------------------------------------------------------------
% APPENDIX
%----------------------------------------------------------------------------
% Appendix sections need to be within the subappendices environment.
% Use the command \appsection{title} instead of \section to introduce each
% appendix. This will add each appendix to the list of appendices.

% sets the appendix environment and resets the section counters
\newpage \begin{appendices} 
\appendixtocon %adds an 'Appendices' entry to the toc

\appendixpage %prints the title on the page

\subsection*{\listappendixname}
%--------------------------------
% style of the \listofappendices command is defined in header.tex
\listofappendices

% begin appendices on a new page
\newpage

%start environment for subappendices, so that new sections are formatted as
%subsections of appendix
\begin{subappendices}
\renewcommand{\setthesubsection}{\arabic{subsection}:}%

\appsection{Some Source Code}
\label{apx:placeholder}

% close the appendices environment
\end{subappendices}
\end{appendices}
